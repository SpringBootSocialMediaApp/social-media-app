<!DOCTYPE html>
<html lang="en" data-theme="dark"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security6">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SocialHub - Home</title>
  <link th:href="@{/css/main.css}" rel="stylesheet"/>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@3.9.4/dist/full.css" rel="stylesheet" type="text/css" />

  <!-- CSRF Token for AJAX requests -->
  <meta name="_csrf" th:content="${_csrf.token}"/>
  <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>
<body class="text-white bg-brand-50">

  <!-- Hidden input to store current user email for JavaScript -->
  <input type="hidden" id="currentUserEmail" th:value="${#authentication.name}" sec:authorize="isAuthenticated()">

  <div th:replace="components/navbar :: navbar"></div>
  <div class="flex mx-auto max-w-7xl">
    <div th:replace="components/profile-sidebar :: profileSidebar"></div>
    <div th:replace="components/feed :: feed"></div>
    <div th:replace="components/right-sidebar :: rightSidebar"></div>
  </div>
  <div th:replace="components/mobile-navbar :: mobileNavbar"></div>

  <script>
    // CSRF setup for AJAX
    const csrfToken = document.querySelector("meta[name='_csrf']").getAttribute("content");
    const csrfHeader = document.querySelector("meta[name='_csrf_header']").getAttribute("content");

    document.addEventListener('DOMContentLoaded', function() {
      // Character counter for post textarea
      const textarea = document.querySelector('textarea[name="content"]');
      const charCounter = document.querySelector('.text-xs.text-gray-700');
      if (textarea && charCounter) {
        textarea.addEventListener('input', function() {
          const count = this.value.length;
          charCounter.textContent = count + '/280 Characters';
          if (count > 280) {
            charCounter.classList.add('text-red-400');
            charCounter.classList.remove('text-gray-700');
          } else {
            charCounter.classList.add('text-gray-700');
            charCounter.classList.remove('text-red-400');
          }
        });
      }

      // Initialize post interactions
      initializePostInteractions();
    });

    // ... (all other JS functions from working home.html) ...

    // Function to show notification messages
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-300 transform translate-x-full ${
        type === 'success' ? 'bg-green-600 text-white' : 
        type === 'error' ? 'bg-red-600 text-white' : 
        'bg-blue-600 text-white'
      }`;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      // Animate in then out
      setTimeout(() => notification.classList.remove('translate-x-full'), 100);
      setTimeout(() => {
        notification.classList.add('translate-x-full');
        setTimeout(() => document.body.removeChild(notification), 300);
      }, 3000);
    }
  </script>

  <!-- Profile Settings Modal -->
  <div id="profileSettingsModal" class="fixed inset-0 z-50 hidden">
    <div class="fixed inset-0 bg-black bg-opacity-50" onclick="closeProfileSettingsModal()"></div>
    <div class="relative flex items-center justify-center min-h-screen p-4">
      <div class="bg-gray-800 rounded-lg shadow-xl w-full max-w-md p-6">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-xl font-bold text-white">Edit Profile</h2>
          <button onclick="closeProfileSettingsModal()" class="text-gray-400 hover:text-white">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>

        <form onsubmit="updateProfileAjax(event)" class="space-y-4">
          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" name="_csrf"/>
          <div>
            <label for="firstName" class="block text-sm font-medium text-gray-300 mb-2">First Name</label>
            <input type="text" id="firstName" name="firstName" required
                   class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"/>
          </div>
          <div>
            <label for="lastName" class="block text-sm font-medium text-gray-300 mb-2">Last Name</label>
            <input type="text" id="lastName" name="lastName" required
                   class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"/>
          </div>
          <div>
            <label for="email" class="block text-sm font-medium text-gray-300 mb-2">Email</label>
            <input type="email" id="email" name="email" required
                   class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"/>
          </div>
          <div>
            <label for="password" class="block text-sm font-medium text-gray-300 mb-2">New Password (optional)</label>
            <input type="password" id="password" name="password"
                   class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                   placeholder="Leave blank to keep current password"/>
          </div>
          <div class="flex gap-3 pt-4">
            <button type="button" onclick="closeProfileSettingsModal()"
                    class="flex-1 px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500">Cancel</button>
            <button type="submit"
                    class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">Update Profile</button>
          </div>
        </form>
      </div>
    </div>
  </div>

</body>
</html>
